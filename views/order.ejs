<div class="order-wrap container">
    <div class="row">
        <div class="col driver-info-and-reviews">
            <!-- ì‚¬ì¥ë‹˜ ì •ë³´ -->
            <div class="driver-info">
                <h1>ì‚¬ì¥ ì´ë¦„</h1>
                <image src="http://t1.daumcdn.net/news/201206/21/ned/20120621145427381.jpg"></image>
            </div>

            <!-- ì‚¬ì¥ë‹˜ ìº í•‘ì¹´ ë¦¬ë·° -->
            <div class="driver-reviews">
                <h1>ë¦¬ë·°ğŸ’­</h1>
                <div class="mx-3" id="review-cards">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ì‘ì„±ì ì´ë¦„</h5>
                            <p class="review-stars">ğŸ˜´ğŸ˜´ğŸ˜´ğŸ˜´ğŸ˜´</p>
                            <p class="review-date">2023-01-11</p>
                            <p class="card-text">ê¿€ì  ì¤ì–´ìš”!</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ã…‡ã…‡</h5>
                            <p class="review-stars">ğŸ˜´</p>
                            <p class="review-date">2023-01-10</p>
                            <p class="card-text">ìš”ì¦˜ ìˆ™ë°•ì—…ì—ëŠ” ë„·í”Œë¦­ìŠ¤ ì œê³µì´ ê¸°ë³¸ ì•„ë‹Œê°€ìš”?</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„œë¹„ìŠ¤ ì‹ ì²­ í¼ -->
        <form class="col order-register needs-validation" novalidate>
            <h1>ì„œë¹„ìŠ¤ ì‹ ì²­í•˜ê¸°</h1>
            <div class="row">
                <div class="col mb-3">
                    <label>ì˜ˆì•½ ì¼ì‹œ (í•„ìˆ˜)</label>
                    <div
                        class="input-group"
                        id="datetimepicker1"
                        data-td-target-input="nearest"
                        data-td-target-toggle="nearest"
                    >
                        <input
                            id="datetimepicker1Input"
                            type="text"
                            class="form-control"
                            data-td-target="#datetimepicker1"
                            required
                        />
                        <span
                            class="input-group-text"
                            data-td-target="#datetimepicker1"
                            data-td-toggle="datetimepicker"
                        >
                            <span class="fa-solid fa-calendar"></span>
                        </span>
                    </div>
                    <script>
                        new tempusDominus.TempusDominus(
                            document.getElementById("datetimepicker1"),
                            {
                                display: {
                                    components: {
                                        seconds: false,
                                        minutes: false,
                                    },
                                    icons: {
                                        type: "icons",
                                        time: "fa fa-solid fa-clock",
                                        date: "fa fa-solid fa-calendar",
                                        up: "fa fa-solid fa-arrow-up",
                                        down: "fa fa-solid fa-arrow-down",
                                        previous: "fa fa-solid fa-chevron-left",
                                        next: "fa fa-solid fa-chevron-right",
                                        today: "fa fa-solid fa-calendar-check",
                                        clear: "fa fa-solid fa-trash",
                                        close: "fas fa-solid fa-xmark",
                                    },
                                },
                                localization: {
                                    hourCycle: "h12",
                                    locale: "ko-KR",
                                },
                                restrictions: {
                                    // í˜„ì¬ ë‚ ì§œ ì´í›„ë§Œ ì„ íƒ ê°€ëŠ¥
                                    minDate: new Date(Date.now()),
                                },
                            }
                        );
                    </script>
                </div>

                <div class="col mb-3">
                    <label for="order-time">ì´ìš© ê¸°ê°„ (í•„ìˆ˜)</label>
                    <input
                        type="number"
                        class="form-control"
                        id="order-time"
                        min="1"
                        max="12"
                        onkeyup="pointsDeducted()"
                        onmouseup="pointsDeducted()"
                        required
                    />
                    <div class="invalid-feedback">ì´ìš© ê¸°ê°„ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.</div>
                </div>
            </div>

            <div class="mb-3">
                <label for="order-request">ìš”êµ¬ ì‚¬í•­ (ì„ íƒ)</label>
                <textarea class="form-control" id="order-request" rows="3"></textarea>
            </div>

            <div id="order-points">
                <p id="points-current">ë³´ìœ í•œ í¬ì¸íŠ¸:<%= user.point %></p>
                <p id="points-deducted">ì°¨ê° í¬ì¸íŠ¸:</p>
                <p id="points-remaining">ì”ì—¬ í¬ì¸íŠ¸:</p>
            </div>

            <button type="button px-5 submit" class="btn btn-primary">ì‹ ì²­</button>
        </form>
    </div>
</div>

<script>
    // // ejs ë¬¸ë²•ìœ¼ë¡œ ë„˜ì–´ì˜¨ isLogined
    const isLogined = "<%= Object.keys(user).length > 0 %>";
    if (isLogined === "false") {
        alert("ë¡œê·¸ì¸ í›„ ì´ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        location.href = "/login";
    }

    // ì´ìš© ê¸°ê°„ì„ í´ë¦­ ë˜ëŠ” ì…ë ¥ì‹œ ì°¨ê° í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸í•˜ê¸°
    function pointsDeducted() {
        let orderTime = document.getElementById("order-time").value;
        orderTime = Number(orderTime);

        let userPoints = "<%= user.point %>";
        userPoints = Number(userPoints);
        console.log(userPoints);

        let remainingPoints = userPoints - orderTime * 10000;

        document.getElementById("points-deducted").innerHTML =
            "ì°¨ê° í¬ì¸íŠ¸: " + orderTime * 10000 + "p";
        document.getElementById("points-remaining").innerHTML =
            "ì”ì—¬ í¬ì¸íŠ¸: " + remainingPoints + "p";
    }

    function postOrder() {
        let rawDate = $("#datetimepicker1Input").val();
        const year = Number(rawDate.split(" ")[0]);
        const month = Number(rawDate.split(" ")[1]);
        const date = Number(rawDate.split(" ")[2]);
        let hour = Number(rawDate.split(" ")[4].split("ì‹œ")[0]);

        if (rawDate.split(" ")[3] === "ì˜¤í›„") {
            hour = hour + 12;
        }

        const usageDateTimeStart = new Date(year, month - 1, date, hour);
        const usageTime = Number($("#order-time").val());
        const request = $("#order-request").val();

        let userId;
        let driverId;

        // $.ajax({
        //     type: 'POST',
        //     url: `/api/orders/${driverId}`,
        //     async: false,
        //     success: function(response) {
        //         // ì„±ê³µ ë©”ì‹œì§€
        //     }
        // })
    }
</script>
<!-- <script src="js/order-datepicker.kr.js"></script> -->
